\begin{tikzpicture}[xscale=1.4,yscale=5]

\tikzset{add reference/.style={insert path={%
    coordinate [pos=0,xshift=-0.5\pgflinewidth,yshift=-0.5\pgflinewidth] (#1 south west)
    coordinate [pos=1,xshift=0.5\pgflinewidth,yshift=0.5\pgflinewidth]   (#1 north east)
    coordinate [pos=.5] (#1 center)
    (#1 south west |- #1 north east)     coordinate (#1 north west)
    (#1 center     |- #1 north east)     coordinate (#1 north)
    (#1 center     |- #1 south west)     coordinate (#1 south)
    (#1 south west -| #1 north east)     coordinate (#1 south east)
    (#1 center     -| #1 south west)     coordinate (#1 west)
    (#1 center     -| #1 north east)     coordinate (#1 east)
}}}

\coordinate (ref) at (0,0);
\coordinate (backref) at (-7.5,0);

%% Magnet
\fill[draw=black,fill=red,opacity=0.75,label=north:MNP18] (2,-0.5) rectangle ++(0.52, 1) [add reference=mnp17];
\node[anchor=south] at (mnp17 north) {\tiny{MNP17}};

%% Cherenkov
% \fill[draw=black,fill=gray,opacity=0.75] (-2.5,-0.1) rectangle ++(-5, 0.2) [add reference=ch0];
% \node[anchor=south] at (ch0 north) {\tiny{CH0}};

% \fill[draw=black,fill=gray,opacity=0.75] (0,-0.1) rectangle ++(-2.5, 0.2) [add reference=ch1];
% \node[anchor=south] at (ch1 north) {\tiny{CH1}};

%% Scint
% \fill[color=green,opacity=0.75] (0,-0.10) rectangle ++(0.03, 0.2) [add reference=sc0];
% \node[anchor=south west] at (sc0 north) {\tiny{SC0}};

\fill[color=green,opacity=0.75] (1.60,-0.10) rectangle ++(0.03, 0.2) [add reference=sc1];
\node[anchor=south west] at (sc1 north) {\tiny{SC1}};

\fill[color=green,opacity=0.75] (3.9,0.05) rectangle ++(0.03, 0.3) [add reference=sc2];
\node[anchor=south] at (sc2 north) {\tiny{SC2}};

%% DWC
\fill[color=blue,opacity=0.75] (0.05,-0.04) rectangle ++(0.05, 0.08) [add reference=dwc0];
\node[anchor=south west] at (dwc0 north) {\tiny{DWC0}};

\fill[color=blue,opacity=0.75] (1.65,-0.04) rectangle ++(0.05, 0.08) [add reference=dwc1];
\node[anchor=north] at (dwc1 south) {\tiny{DWC1}};

\fill[color=blue,opacity=0.75] (3,0) rectangle ++(0.05, 0.08) [add reference=dwc2];
\node[anchor=south] at (dwc2 north) {\tiny{DWC2}};

%% Calo
\fill[draw=black,fill=yellow,opacity=0.75] (5,-0.05) rectangle ++(0.3, 0.1) [add reference=photon_calo];
\node[anchor=south] at (photon_calo south) {\tiny{Photon Calo}};

\fill[draw=black,fill=orange,opacity=0.75] (4,0.25) rectangle ++(0.3, 0.1) [add reference=lg3];
\node[anchor=south] at (lg3 north) {\tiny{LG3}};

\fill[draw=black,fill=orange,opacity=0.75] (4,0.15) rectangle ++(0.3, 0.1) [add reference=lg2];
\node[anchor=south] at (lg2 north) {\tiny{LG2}};

\fill[draw=black,fill=orange,opacity=0.75] (4,0.05) rectangle ++(0.3, 0.1) [add reference=lg1];
\node[anchor=south] at (lg1 north) {\tiny{LG1}};

%% Crystal
\fill[color=black,opacity=0.75] (1.7,-0.075) rectangle ++(0.1, 0.15) [add reference=goniometer];
\node[anchor=north] at (goniometer south) {\tiny{Goniometer}};

\fill[color=black,opacity=0.75] (1.8,-0.002) rectangle ++(0.001, 0.004) [add reference=crystal];
\node[anchor=south] at (crystal north) {\tiny{Crystal}};

%% DESY table
\fill[color=gray,opacity=0.75] (3.2,0) rectangle ++(0.5, 0.5) [add reference=desytable];
\node[anchor=south] at (desytable north) {\tiny{DESY Table}};

%% Reference trajectories
% \draw[->] (mnp17 west) arc (-90:-89.4998:59.5650185) -- (5,0.0327) node[anchor=west] {\tiny{$p = 10\,\mathrm{GeV}$}};
\draw[->] (mnp17 west) -- (2.52,0.00027) -- (6,0.0327) node[anchor=west] {\tiny{$p = 10\,\mathrm{GeV}$}};
\draw[->] (mnp17 west) arc (-90:-88.3335:17.8695) -- (6,0.1089) node[anchor=west] {\tiny{$p = 3\,\mathrm{GeV}$}};
\draw[->] (mnp17 west) arc (-90:-84.992:5.9565) -- (6,0.3277) node[anchor=west] {\tiny{$p = 1\,\mathrm{GeV}$}};
% \draw[->] (mnp17 west)  arc  (-90:-91:595.7) node[anchor=west] {\tiny{$p = e\,\mathrm{GeV}$}};
\draw[->] (mnp17 west)  arc  (-90:-80:2.978) -- (6,0.6628) node[anchor=west] {\tiny{$p = 0.5\,\mathrm{GeV}$}};

% Draw main coordinate system
\draw[->] (ref) -- ++(5.5,0) node[anchor=north west]{$z$};
\draw (0,-0.45) -- (ref) -- ++(0,0.55);
% \draw (backref) -- (ref);
\draw[->] (0,-0.45) -- (ref) -- ++(0,0.55) node[anchor=south east]{$x$};

\foreach \x in {-4,-3,...,4}{
    \pgfmathsetmacro\result{\x * 100}
    \draw (0,0.1 * \x) -- ++(-0.05,0) node[anchor=east]{\result};
}
\draw (0,0.5) -- ++(-0.05,0) node[anchor=east]{500\,mm};

\foreach \z in {1,2,...,4}{
    \draw (\z,0) -- ++(0,-0.05) node[anchor=north]{\z};
}
\draw (5,0) -- ++(0,-0.05) node[anchor=north]{5\,m};

\end{tikzpicture}
